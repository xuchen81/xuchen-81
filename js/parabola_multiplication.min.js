$(function(){function t(t,e){d3.select("#dragging").remove(),d3.select("#dragged_active").remove()}function e(t,e){var r=t.cx,c=t.cy
y.append("line").style("stroke","#9723C4").attr("stroke-width",3).attr("x1",r).attr("y1",c).attr("x2",r).attr("y2",c+1).style("opacity",.8).attr("id","dragging"),d3.event.on("drag",function(){var t=d3.event.x,e=d3.event.y
d3.select("#dragging").attr("x2",t).attr("y2",e)})}function r(t,e){var r=d3.event.x,a=d3.event.y,n=[{cx:41*c,cy:s},{cx:45*c,cy:c+s},{cx:49*c,cy:4*c+s},{cx:53*c,cy:9*c+s},{cx:57*c,cy:16*c+s},{cx:61*c,cy:25*c+s},{cx:65*c,cy:36*c+s},{cx:69*c,cy:49*c+s},{cx:73*c,cy:64*c+s},{cx:77*c,cy:81*c+s},{cx:81*c,cy:100*c+s}]
if(t.cx<41*c){for(var e=0;e<n.length;e++)if(r<n[e].cx+A&&r>n[e].cx-A&&a<n[e].cy+A&&a>n[e].cy-A)return d3.select("#dragging").attr("x2",n[e].cx).attr("y2",n[e].cy).attr("id","dragged_active"),1
return d3.select("#dragging").remove(),0}var x=[{cx:1*c,cy:100*c+s},{cx:5*c,cy:81*c+s},{cx:9*c,cy:64*c+s},{cx:13*c,cy:49*c+s},{cx:17*c,cy:36*c+s},{cx:21*c,cy:25*c+s},{cx:25*c,cy:16*c+s},{cx:29*c,cy:9*c+s},{cx:33*c,cy:4*c+s},{cx:37*c,cy:c+s}]
if(t.cx>41*c){for(var e=0;e<x.length;e++)if(r<x[e].cx+A&&r>x[e].cx-A&&a<x[e].cy+A&&a>x[e].cy-A)return d3.select("#dragging").attr("x2",x[e].cx).attr("y2",x[e].cy).attr("id","dragged_active"),1
return d3.select("#dragging").remove(),0}var i=n.concat(x)
if(t.cx==41*c){for(var e=0;e<i.length;e++)if(r<i[e].cx+A&&r>i[e].cx-A&&a<i[e].cy+A&&a>i[e].cy-A)return d3.select("#dragging").attr("x2",i[e].cx).attr("y2",i[e].cy).attr("id","dragged_active"),1
return d3.select("#dragging").remove(),0}}for(var c=10,a=20,n="#ed5842",x=820,i=1060,y=d3.select("#canvas").append("svg").attr("width",x).attr("height",i),d=82,l=100,s=20,o=0;l>o;o++)for(var g=0;d>g;g++){var u=g*c,f=o*c+s
y.append("rect").attr("x",u).attr("y",f).attr("width",c).attr("height",c).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id",o+"_"+g).attr("class","cell")}var h=[{x:36*c,y:0,size:a,text:2},{x:40*c,y:0,size:a,text:2},{x:44*c,y:0,size:a,text:3}]
y.selectAll("rect.first_row_orange").data(h).enter().append("rect").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.size}).attr("height",function(t){return t.size}).attr("fill",n).style("opacity",.9)
for(var v=10,p=0,z=1,o=0;80>=o;o+=4){var w="text_"+z
y.append("text").attr("x",o*c+c-5).attr("y",10).text(v).style("font-size","12px").style("font-weight","bold").attr("id",w)
var k=d3.select("#"+w).node().getBoundingClientRect().width,_=d3.select("#"+w).node().getBoundingClientRect().height
d3.select("#"+w).attr("x",o*c+c-k/2).attr("y",6+_/2),0==v&&(p=1),v>0&&0==p&&(v-=1),1==p&&(v+=1),z+=1}for(var C=["text_10","text_11","text_12"],b=[37*c,41*c,45*c],o=0;o<C.length;o++){var w=C[o]
d3.select("#"+w).style("font-size","20px").style("font-weight","bold").style("fill","white")
var k=d3.select("#"+w).node().getBoundingClientRect().width,_=d3.select("#"+w).node().getBoundingClientRect().height
d3.select("#"+w).attr("x",b[o]-k/2).attr("y",19-Math.abs(10-_/2))}y.append("line").style("stroke","black").attr("stroke-width",3).attr("x1",0).attr("y1",s).attr("x2",d*c).attr("y2",s)
var B=4,R=[{cx:1*c,cy:100*c+s,r:B},{cx:5*c,cy:81*c+s,r:B},{cx:9*c,cy:64*c+s,r:B},{cx:13*c,cy:49*c+s,r:B},{cx:17*c,cy:36*c+s,r:B},{cx:21*c,cy:25*c+s,r:B},{cx:25*c,cy:16*c+s,r:B},{cx:29*c,cy:9*c+s,r:B},{cx:33*c,cy:4*c+s,r:B},{cx:37*c,cy:c+s,r:B},{cx:41*c,cy:s,r:B},{cx:45*c,cy:c+s,r:B},{cx:49*c,cy:4*c+s,r:B},{cx:53*c,cy:9*c+s,r:B},{cx:57*c,cy:16*c+s,r:B},{cx:61*c,cy:25*c+s,r:B},{cx:65*c,cy:36*c+s,r:B},{cx:69*c,cy:49*c+s,r:B},{cx:73*c,cy:64*c+s,r:B},{cx:77*c,cy:81*c+s,r:B},{cx:81*c,cy:100*c+s,r:B}],m=d3.line().x(function(t){return t.cx}).y(function(t){return t.cy}).curve(d3.curveCardinal)
y.append("path").attr("d",m(R)).attr("stroke","#429cbc").attr("stroke-width",3).attr("fill","none")
y.selectAll("circle").data(R).enter().append("circle").attr("cx",function(t){return t.cx}).attr("cy",function(t){return t.cy}).attr("r",function(t){return t.r}).style("stroke",n).style("stroke-width",2).call(d3.drag().on("start",t).on("drag",e).on("end",r))
var A=8
y.selectAll("line.orange").data(R).enter().append("line").attr("x1",function(t){return t.cx}).attr("y1",function(t){return s}).attr("x2",function(t){return t.cx}).attr("y2",function(t){return t.cy==s?s:t.cy-B}).style("stroke",n).style("stroke-width",3).style("opacity",.9)
for(var o=1;l>=o;o++){var w="t_"+o
y.append("text").attr("x",41*c-5).attr("y",s+o*c-.5*c).text(o).style("font-size","10px").style("font-weight","bold").attr("id",w)
var k=d3.select("#"+w).node().getBoundingClientRect().width,_=d3.select("#"+w).node().getBoundingClientRect().height
d3.select("#"+w).attr("x",41*c-k/2).attr("y",s+(o+1)*c-.5*_)}var h=[{x:32*c,y:s+5,size:a,text:2},{x:48*c,y:s+5,size:a,text:2},{x:28*c,y:s+5*c,size:a,text:3},{x:52*c,y:s+5*c,size:a,text:3},{x:24*c,y:s+12*c-5,size:a,text:4},{x:56*c,y:s+12*c-5,size:a,text:4},{x:20*c,y:s+20*c,size:a,text:5},{x:60*c,y:s+20*c,size:a,text:5},{x:16*c,y:s+30*c,size:a,text:6},{x:64*c,y:s+30*c,size:a,text:6},{x:12*c,y:s+42*c+5,size:a,text:7},{x:68*c,y:s+42*c+5,size:a,text:7},{x:8*c,y:s+57*c,size:a,text:8},{x:72*c,y:s+57*c,size:a,text:8},{x:4*c,y:s+73*c,size:a,text:9},{x:76*c,y:s+73*c,size:a,text:9},{x:0*c,y:s+92*c,size:a,text:10},{x:80*c,y:s+92*c,size:a,text:10}]
y.selectAll("rect.orange").data(h).enter().append("rect").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.size}).attr("height",function(t){return t.size}).attr("fill",n).style("opacity",.9)
for(var o=0;o<h.length;o++){var w="white_"+o
y.append("text").attr("x",h[o].x).attr("y",h[o].y+20).text(h[o].text).style("font-size","20px").style("font-weight","bold").attr("id",w).style("fill","white")
var k=d3.select("#"+w).node().getBoundingClientRect().width,_=d3.select("#"+w).node().getBoundingClientRect().height
d3.select("#"+w).attr("x",h[o].x+10-k/2).attr("y",h[o].y+20-Math.abs(10-_/2))}})
