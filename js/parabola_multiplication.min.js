$(function(){function t(t,r){d3.select("#dragging").remove(),d3.select("#dragged_active").remove()}function r(t,r){var c=t.cx,e=t.cy
y.append("line").style("stroke","#9723C4").attr("stroke-width",3).attr("x1",c).attr("y1",e).attr("x2",c).attr("y2",e+1).attr("id","dragging"),d3.event.on("drag",function(){var t=d3.event.x,r=d3.event.y
d3.select("#dragging").attr("x2",t).attr("y2",r)})}function c(t,r){var c=d3.event.x,a=d3.event.y,n=[{cx:41*e,cy:i},{cx:45*e,cy:e+i},{cx:49*e,cy:4*e+i},{cx:53*e,cy:9*e+i},{cx:57*e,cy:16*e+i},{cx:61*e,cy:25*e+i},{cx:65*e,cy:36*e+i},{cx:69*e,cy:49*e+i},{cx:73*e,cy:64*e+i},{cx:77*e,cy:81*e+i},{cx:81*e,cy:100*e+i}]
if(t.cx<41*e){for(var r=0;r<n.length;r++)if(c<n[r].cx+b&&c>n[r].cx-b&&a<n[r].cy+b&&a>n[r].cy-b)return d3.select("#dragging").attr("x2",n[r].cx).attr("y2",n[r].cy).attr("id","dragged_active"),1
return d3.select("#dragging").remove(),0}var y=[{cx:1*e,cy:100*e+i},{cx:5*e,cy:81*e+i},{cx:9*e,cy:64*e+i},{cx:13*e,cy:49*e+i},{cx:17*e,cy:36*e+i},{cx:21*e,cy:25*e+i},{cx:25*e,cy:16*e+i},{cx:29*e,cy:9*e+i},{cx:33*e,cy:4*e+i},{cx:37*e,cy:e+i}]
if(t.cx>41*e){for(var r=0;r<y.length;r++)if(c<y[r].cx+b&&c>y[r].cx-b&&a<y[r].cy+b&&a>y[r].cy-b)return d3.select("#dragging").attr("x2",y[r].cx).attr("y2",y[r].cy).attr("id","dragged_active"),1
return d3.select("#dragging").remove(),0}var d=n.concat(y)
if(t.cx==41*e){for(var r=0;r<d.length;r++)if(c<d[r].cx+b&&c>d[r].cx-b&&a<d[r].cy+b&&a>d[r].cy-b)return d3.select("#dragging").attr("x2",d[r].cx).attr("y2",d[r].cy).attr("id","dragged_active"),1
return d3.select("#dragging").remove(),0}}for(var e=10,a=820,n=1060,y=d3.select("#canvas").append("svg").attr("width",a).attr("height",n),d=82,x=100,i=20,l=0;x>l;l++)for(var o=0;d>o;o++){var g=o*e,s=l*e+i
y.append("rect").attr("x",g).attr("y",s).attr("width",e).attr("height",e).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id",l+"_"+o).attr("class","cell")}for(var v=10,u=0,f=1,l=0;80>=l;l+=4){var h="text_"+f
y.append("text").attr("x",l*e+e-5).attr("y",10).text(v).style("font-size","12px").style("font-weight","bold").attr("id",h)
var p=d3.select("#"+h).node().getBoundingClientRect().width,k=d3.select("#"+h).node().getBoundingClientRect().height
d3.select("#"+h).attr("x",l*e+e-p/2).attr("y",10),0==v&&(u=1),v>0&&0==u&&(v-=1),1==u&&(v+=1),f+=1}y.append("line").style("stroke","black").attr("stroke-width",3).attr("x1",0).attr("y1",i).attr("x2",d*e).attr("y2",i)
var w=4,_=[{cx:1*e,cy:100*e+i,r:w},{cx:5*e,cy:81*e+i,r:w},{cx:9*e,cy:64*e+i,r:w},{cx:13*e,cy:49*e+i,r:w},{cx:17*e,cy:36*e+i,r:w},{cx:21*e,cy:25*e+i,r:w},{cx:25*e,cy:16*e+i,r:w},{cx:29*e,cy:9*e+i,r:w},{cx:33*e,cy:4*e+i,r:w},{cx:37*e,cy:e+i,r:w},{cx:41*e,cy:i,r:w},{cx:45*e,cy:e+i,r:w},{cx:49*e,cy:4*e+i,r:w},{cx:53*e,cy:9*e+i,r:w},{cx:57*e,cy:16*e+i,r:w},{cx:61*e,cy:25*e+i,r:w},{cx:65*e,cy:36*e+i,r:w},{cx:69*e,cy:49*e+i,r:w},{cx:73*e,cy:64*e+i,r:w},{cx:77*e,cy:81*e+i,r:w},{cx:81*e,cy:100*e+i,r:w}],C=d3.line().x(function(t){return t.cx}).y(function(t){return t.cy}).curve(d3.curveCardinal),m=(y.append("path").attr("d",C(_)).attr("stroke","#429cbc").attr("stroke-width",3).attr("fill","none"),"#ed5842")
y.selectAll("circle").data(_).enter().append("circle").attr("cx",function(t){return t.cx}).attr("cy",function(t){return t.cy}).attr("r",function(t){return t.r}).style("stroke",m).style("stroke-width",2).call(d3.drag().on("start",t).on("drag",r).on("end",c))
var b=8
y.selectAll("line").data(_).enter().append("line").attr("x1",function(t){return t.cx}).attr("y1",function(t){return i}).attr("x2",function(t){return t.cx}).attr("y2",function(t){return t.cy==i?i:t.cy-w}).style("stroke",m).style("stroke-width",3),y.append("line").style("stroke",m).attr("stroke-width",3).attr("x1",1*e).attr("y1",i).attr("x2",1*e).attr("y2",100*e+i-w)
for(var l=1;x>=l;l++){var h="t_"+l
y.append("text").attr("x",41*e-5).attr("y",i+l*e-.5*e).text(l).style("font-size","10px").style("font-weight","bold").attr("id",h)
var p=d3.select("#"+h).node().getBoundingClientRect().width,k=d3.select("#"+h).node().getBoundingClientRect().height
d3.select("#"+h).attr("x",41*e-p/2).attr("y",i+(l+1)*e-.5*k)}})
