$(function(){function t(t,r){return Math.floor(Math.random()*(r-t+1))+t}var r=[[15,5],[15,4],[15,3],[15,2],[12,5],[12,4],[12,3],[12,2],[10,4],[10,3],[10,2],[10,1],[8,3],[8,2],[8,1]],e=t(0,r.length-1),a=r[e][0],s="#DAF5E8",i=function(t){for(var r=[],e=0,a=0;a<t.length;a++)1==t[a]?e+=1:0==t[a]&&0!=e&&(r.push(e),e=0)
return 0==r.length&&r.push(0),r},n=[],l=[]
for(p=0;a>p;p++){var o=[],c=[]
for(_=0;a>_;_++){var d=t(0,r[e][1])
d>=1?o.push(1):o.push(0),c.push(0)}n.push(o),l.push(c)}for(var h=0,f=[],p=0;p<n.length;p++){var v=i(n[p].concat([0]))
f.push(v),v.length>h&&(h=v.length)}for(var u=[],p=0;a>p;p++){for(var g=[],_=0;a>_;_++)g.push(n[_][p])
var v=i(g.concat([0]))
u.push(v),v.length>h&&(h=v.length)}for(var y=35,w=null,k=50,b=50,x=20,m=20*h,I=30,j=I,C=m,S=a*y+C+50,z=1e3,A=d3.select("#canvas").append("svg").attr("width",S).attr("height",z),p=0;a>p;p++)for(var _=0;a>_;_++){var B=_*y+C+x,R=p*y+m+x
A.append("rect").attr("x",B).attr("y",R).attr("width",y).attr("height",y).attr("fill","white").attr("stroke-width",5).attr("stroke","gray").attr("id",p+"_"+_).attr("class","cell")}for(var p=0;a>p;p++){var B=p*y+C+y/2-I/2+x,R=0
A.append("rect").attr("x",B).attr("y",R).attr("width",I).attr("height",m).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id","top_a_"+p)}for(var p=0;a>p;p++){var B=0,R=p*y+m+y/2-j/2+x
A.append("rect").attr("x",B).attr("y",R).attr("width",C).attr("height",j).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id","left_a_"+p)}var H=m+2*x+a*y,M=C+x+a*y/2-b-k/2
A.append("rect").attr("x",M).attr("y",H).attr("width",b).attr("height",b).attr("fill","white").attr("stroke-width",4).attr("class","yes_btn").attr("id","yes_btn_boader").attr("stroke","gray"),A.append("rect").attr("x",M+10).attr("y",H+10).attr("width",b-20).attr("height",b-20).attr("fill","black").attr("stroke-width",4).attr("class","yes_btn").attr("stroke","gray")
var P=m+2*x+a*y,D=C+x+a*y/2+k/2
A.append("rect").attr("x",D).attr("y",P).attr("width",b).attr("height",b).attr("fill","white").attr("stroke-width",4).attr("class","no_btn").attr("id","no_btn_boader").attr("stroke","gray")
var E=D+b/2,F=P+b/2
A.append("path").attr("d",d3.svg.symbol().size(700).type(function(t){return"cross"})).attr("class","no_btn").attr("transform","translate("+E+","+F+") rotate(45)").attr("fill","red"),d3.selectAll(".yes_btn").on("click",function(){d3.select("rect[id='yes_btn_boader']").attr("stroke-width",10).attr("stroke","green"),d3.select("rect[id='no_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),w="yes"}),d3.selectAll(".no_btn").on("click",function(){d3.select("rect[id='yes_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),d3.select("rect[id='no_btn_boader']").attr("stroke-width",10).attr("stroke","green"),w="no"}),d3.select(".yes_btn").on("click")(),d3.selectAll("rect[class='cell']").on("click",function(){if("yes"==w){var t=d3.select(this).attr("id"),r=t.split("_"),e=parseInt(r[0]),n=parseInt(r[1]),o=d3.select(this).attr("fill")
"black"==o?(d3.select(this).attr("fill","white"),l[e][n]=0):"white"==o&&(d3.select(this).attr("fill","black"),l[e][n]=1)
for(var c=[],d=0;a>d;d++){var h=e+"_"+d,p=d3.select("rect[id='"+h+"']").attr("fill")
"white"==p?c.push(0):"black"==p&&c.push(1)}c.push(0)
var v=i(c)
if(v.toString()==f[e].toString()){var g="left_a_"+e
d3.select("#"+g).transition().attr("fill",s)}else{var g="left_a_"+e
d3.select("#"+g).transition().attr("fill","white")}for(var _=[],d=0;a>d;d++){var h=d+"_"+n,p=d3.select("rect[id='"+h+"']").attr("fill")
"white"==p?_.push(0):"black"==p&&_.push(1)}_.push(0)
var v=i(_)
if(v.reverse(),v.toString()==u[n].toString()){var g="top_a_"+n
d3.select("#"+g).transition().attr("fill",s)}else{var g="top_a_"+n
d3.select("#"+g).transition().attr("fill","white")}for(var k=[],d=0;d<l.length;d++){var b=i(l[d].concat([0]))
k.push(b)}for(var x=[],d=0;a>d;d++){for(var m=[],I=0;a>I;I++)m.push(l[I][d])
var b=i(m.concat([0]))
x.push(b)}for(var d=0;a>d;d++)if(x[d].reverse(),x[d].join(",")!=u[d].join(","))return
for(var d=0;a>d;d++)if(k[d].join(",")!=f[d].join(","))return
setTimeout(function(){alert("Congrats! You win!")},1100)}else if("no"==w){if("black"==d3.select(this).attr("fill"))return
var j=d3.select(this).attr("id"),C="cross_"+j,S=d3.select("path[id='"+C+"']")
if(1==S.size())S.remove()
else if(0==S.size()){var $=parseInt(d3.select(this).attr("x"))+y/2,z=parseInt(d3.select(this).attr("y"))+y/2
A.append("path").attr("d",d3.svg.symbol().size(350).type(function(t){return"cross"})).attr("id",C).attr("class","cross").attr("transform","translate("+$+","+z+") rotate(45)").attr("fill","red").on("click",function(){d3.select(this).remove()})}}})
for(var p=0;a>p;p++){var T="left_a_"+p,Y=parseInt(d3.select("#"+T).attr("x")),q=parseInt(d3.select("#"+T).attr("y")),G=f[p].join(" "),J=T+"_text"
A.append("text").attr("x",Y).attr("y",q).text(G).attr("id",J)
var K=d3.select("#"+J).node().getBoundingClientRect().width,L=d3.select("#"+J).node().getBoundingClientRect().height
d3.select("#"+J).attr("x",Y+C-K-8).attr("y",q+L/2+j/2-4)}for(var p=0;a>p;p++){var T="top_a_"+p,Y=parseInt(d3.select("#"+T).attr("x")),q=parseInt(d3.select("#"+T).attr("y"))
u[p].reverse()
for(var _=0;_<u[p].length;_++){var J=T+"_text_"+_
A.append("text").attr("x",Y).attr("y",q).text(u[p][_]).attr("id",J)
var K=d3.select("#"+J).node().getBoundingClientRect().width,L=d3.select("#"+J).node().getBoundingClientRect().height
d3.select("#"+J).attr("x",Y+I/2-K/2).attr("y",m-_*L-6)}}$("#hint_btn button").click(function(){$("#instructions").is(":visible")?$(this).html("Show How to Play"):$(this).html("Hide How to Play")})})
