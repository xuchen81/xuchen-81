$(function(){function t(t,r){return Math.floor(Math.random()*(r-t+1))+t}var r=[[15,5],[15,4],[15,3],[15,2],[12,5],[12,4],[12,3],[12,2],[10,4],[10,3],[10,2],[10,1],[8,3],[8,2],[8,1]],e=t(0,r.length-1),a=r[e][0],s="#DAF5E8",i=function(t){for(var r=[],e=0,a=0;a<t.length;a++)1==t[a]?e+=1:0==t[a]&&0!=e&&(r.push(e),e=0)
return 0==r.length&&r.push(0),r},l=[],n=[]
for(f=0;a>f;f++){var o=[],d=[]
for(y=0;a>y;y++){var c=t(0,r[e][1])
c>=1?o.push(1):o.push(0),d.push(0)}l.push(o),n.push(d)}for(var h=0,p=[],f=0;f<l.length;f++){var v=i(l[f].concat([0]))
p.push(v),v.length>h&&(h=v.length)}for(var _=[],f=0;a>f;f++){for(var u=[],y=0;a>y;y++)u.push(l[y][f])
var v=i(u.concat([0]))
_.push(v),v.length>h&&(h=v.length)}for(var g=35,k=null,w=50,b=50,x=20,I=20*h,m=30,j=m,C=I,S=a*g+C+50,z=1e3,A=d3.select("#canvas").append("svg").attr("width",S).attr("height",z),f=0;a>f;f++)for(var y=0;a>y;y++){var B=y*g+C+x,R=f*g+I+x
A.append("rect").attr("x",B).attr("y",R).attr("width",g).attr("height",g).attr("fill","white").attr("stroke-width",5).attr("stroke","gray").attr("id",f+"_"+y).attr("class","cell")}for(var f=0;a>f;f++){var B=f*g+C+g/2-m/2+x,R=0
A.append("rect").attr("x",B).attr("y",R).attr("width",m).attr("height",I).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id","top_a_"+f)}for(var f=0;a>f;f++){var B=0,R=f*g+I+g/2-j/2+x
A.append("rect").attr("x",B).attr("y",R).attr("width",C).attr("height",j).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id","left_a_"+f)}var H=I+2*x+a*g,M=C+x+a*g/2-b-w/2
A.append("rect").attr("x",M).attr("y",H).attr("width",b).attr("height",b).attr("fill","white").attr("stroke-width",4).attr("class","yes_btn").attr("id","yes_btn_boader").attr("stroke","gray"),A.append("rect").attr("x",M+10).attr("y",H+10).attr("width",b-20).attr("height",b-20).attr("fill","black").attr("stroke-width",4).attr("class","yes_btn").attr("stroke","gray")
var P=I+2*x+a*g,D=C+x+a*g/2+w/2
A.append("rect").attr("x",D).attr("y",P).attr("width",b).attr("height",b).attr("fill","white").attr("stroke-width",4).attr("class","no_btn").attr("id","no_btn_boader").attr("stroke","gray")
var E=D+b/2,F=P+b/2
A.append("path").attr("d",d3.svg.symbol().size(700).type(function(t){return"cross"})).attr("class","no_btn").attr("transform","translate("+E+","+F+") rotate(45)").attr("fill","red")
var T=null
T=15==a||10==a?5:4
for(var Y=a/T-1,f=0;Y>f;f++){var o=T*(f+1),q=o+"_0",G=parseInt(d3.select("rect[id='"+q+"']").attr("x")),J=parseInt(d3.select("rect[id='"+q+"']").attr("y")),K=o+"_"+(a-1),L=parseInt(d3.select("rect[id='"+K+"']").attr("x"))+g,N=parseInt(d3.select("rect[id='"+K+"']").attr("y"))
A.append("line").style("stroke","black").attr("stroke-width",3).attr("x1",G).attr("y1",J).attr("x2",L).attr("y2",N)}for(var f=0;Y>f;f++){var u=T*(f+1),q="0_"+u,G=parseInt(d3.select("rect[id='"+q+"']").attr("x")),J=parseInt(d3.select("rect[id='"+q+"']").attr("y")),K=a-1+"_"+u,L=parseInt(d3.select("rect[id='"+K+"']").attr("x")),N=parseInt(d3.select("rect[id='"+K+"']").attr("y"))+g
A.append("line").style("stroke","black").attr("stroke-width",3).attr("x1",G).attr("y1",J).attr("x2",L).attr("y2",N)}d3.selectAll(".yes_btn").on("click",function(){d3.select("rect[id='yes_btn_boader']").attr("stroke-width",10).attr("stroke","green"),d3.select("rect[id='no_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),k="yes"}),d3.selectAll(".no_btn").on("click",function(){d3.select("rect[id='yes_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),d3.select("rect[id='no_btn_boader']").attr("stroke-width",10).attr("stroke","green"),k="no"}),d3.select(".yes_btn").on("click")(),d3.selectAll("rect[class='cell']").on("click",function(){if("yes"==k){var t=d3.select(this).attr("id"),r=t.split("_"),e=parseInt(r[0]),l=parseInt(r[1]),o=d3.select(this).attr("fill")
"black"==o?(d3.select(this).attr("fill","white"),n[e][l]=0):"white"==o&&(d3.select(this).attr("fill","black"),n[e][l]=1)
for(var d=[],c=0;a>c;c++){var h=e+"_"+c,f=d3.select("rect[id='"+h+"']").attr("fill")
"white"==f?d.push(0):"black"==f&&d.push(1)}d.push(0)
var v=i(d)
if(v.toString()==p[e].toString()){var u="left_a_"+e
d3.select("#"+u).transition().attr("fill",s)}else{var u="left_a_"+e
d3.select("#"+u).transition().attr("fill","white")}for(var y=[],c=0;a>c;c++){var h=c+"_"+l,f=d3.select("rect[id='"+h+"']").attr("fill")
"white"==f?y.push(0):"black"==f&&y.push(1)}y.push(0)
var v=i(y)
if(v.reverse(),v.toString()==_[l].toString()){var u="top_a_"+l
d3.select("#"+u).transition().attr("fill",s)}else{var u="top_a_"+l
d3.select("#"+u).transition().attr("fill","white")}for(var w=[],c=0;c<n.length;c++){var b=i(n[c].concat([0]))
w.push(b)}for(var x=[],c=0;a>c;c++){for(var I=[],m=0;a>m;m++)I.push(n[m][c])
var b=i(I.concat([0]))
x.push(b)}for(var c=0;a>c;c++)if(x[c].reverse(),x[c].join(",")!=_[c].join(","))return
for(var c=0;a>c;c++)if(w[c].join(",")!=p[c].join(","))return
setTimeout(function(){alert("Congrats! You win!")},1100)}else if("no"==k){if("black"==d3.select(this).attr("fill"))return
var j=d3.select(this).attr("id"),C="cross_"+j,S=d3.select("path[id='"+C+"']")
if(1==S.size())S.remove()
else if(0==S.size()){var $=parseInt(d3.select(this).attr("x"))+g/2,z=parseInt(d3.select(this).attr("y"))+g/2
A.append("path").attr("d",d3.svg.symbol().size(350).type(function(t){return"cross"})).attr("id",C).attr("class","cross").attr("transform","translate("+$+","+z+") rotate(45)").attr("fill","red").on("click",function(){d3.select(this).remove()})}}})
for(var f=0;a>f;f++){var q="left_a_"+f,O=parseInt(d3.select("#"+q).attr("x")),Q=parseInt(d3.select("#"+q).attr("y")),U=p[f].join(" "),V=q+"_text"
A.append("text").attr("x",O).attr("y",Q).text(U).attr("id",V)
var W=d3.select("#"+V).node().getBoundingClientRect().width,X=d3.select("#"+V).node().getBoundingClientRect().height
d3.select("#"+V).attr("x",O+C-W-8).attr("y",Q+X/2+j/2-4)}for(var f=0;a>f;f++){var q="top_a_"+f,O=parseInt(d3.select("#"+q).attr("x")),Q=parseInt(d3.select("#"+q).attr("y"))
_[f].reverse()
for(var y=0;y<_[f].length;y++){var V=q+"_text_"+y
A.append("text").attr("x",O).attr("y",Q).text(_[f][y]).attr("id",V)
var W=d3.select("#"+V).node().getBoundingClientRect().width,X=d3.select("#"+V).node().getBoundingClientRect().height
d3.select("#"+V).attr("x",O+m/2-W/2).attr("y",I-y*X-6)}}$("#hint_btn button").click(function(){$("#instructions").is(":visible")?$(this).html("Show How to Play"):$(this).html("Hide How to Play")})})
