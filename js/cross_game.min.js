$(function(){function t(t,r){return Math.floor(Math.random()*(r-t+1))+t}var r=[[15,5],[15,4],[15,3],[15,2],[12,5],[12,4],[12,3],[12,2],[10,4],[10,3],[10,2],[10,1],[8,3],[8,2],[8,1]],e=t(0,r.length-1),a=r[e][0],s="#DAF5E8",i=function(t){for(var r=[],e=0,a=0;a<t.length;a++)1==t[a]?e+=1:0==t[a]&&0!=e&&(r.push(e),e=0)
return 0==r.length&&r.push(0),r},l=[],n=[]
for(f=0;a>f;f++){var o=[],d=[]
for(u=0;a>u;u++){var c=t(0,r[e][1])
c>=1?o.push(1):o.push(0),d.push(0)}l.push(o),n.push(d)}for(var h=0,p=[],f=0;f<l.length;f++){var v=i(l[f].concat([0]))
p.push(v),v.length>h&&(h=v.length)}for(var y=[],f=0;a>f;f++){for(var _=[],u=0;a>u;u++)_.push(l[u][f])
var v=i(_.concat([0]))
y.push(v),v.length>h&&(h=v.length)}for(var g=35,k=null,w=50,b=50,x=20,I=20*h,m=25,C=m,j=I,z=a*g+j+50,S=1e3,A=d3.select("#canvas").append("svg").attr("width",z).attr("height",S),f=0;a>f;f++)for(var u=0;a>u;u++){var B=u*g+j+x,R=f*g+I+x
A.append("rect").attr("x",B).attr("y",R).attr("width",g).attr("height",g).attr("fill","white").attr("stroke-width",5).attr("stroke","gray").attr("id",f+"_"+u).attr("class","cell")}for(var f=0;a>f;f++){var B=f*g+j+g/2-m/2+x,R=0
A.append("rect").attr("x",B).attr("y",R).attr("rx",3).attr("ry",3).attr("width",m).attr("height",I).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id","top_a_"+f)}for(var f=0;a>f;f++){var B=0,R=f*g+I+g/2-C/2+x
A.append("rect").attr("x",B).attr("y",R).attr("rx",3).attr("ry",3).attr("width",j).attr("height",C).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id","left_a_"+f)}var D=I+2*x+a*g,H=j+x+a*g/2-b-w/2
A.append("rect").attr("x",H).attr("y",D).attr("rx",3).attr("ry",3).attr("width",b).attr("height",b).attr("fill","white").attr("stroke-width",4).attr("class","yes_btn").attr("id","yes_btn_boader").attr("stroke","gray"),A.append("rect").attr("x",H+10).attr("y",D+10).attr("width",b-20).attr("height",b-20).attr("fill","black").attr("stroke-width",4).attr("class","yes_btn").attr("stroke","gray")
var M=I+2*x+a*g,P=j+x+a*g/2+w/2
A.append("rect").attr("x",P).attr("y",M).attr("rx",3).attr("ry",3).attr("width",b).attr("height",b).attr("fill","white").attr("stroke-width",4).attr("class","no_btn").attr("id","no_btn_boader").attr("stroke","gray")
var E=P+b/2,F=M+b/2
A.append("path").attr("d",d3.svg.symbol().size(700).type(function(t){return"cross"})).attr("class","no_btn").attr("transform","translate("+E+","+F+") rotate(45)").attr("fill","red")
var T=null
T=15==a||10==a?5:4
for(var Y=a/T-1,f=0;Y>f;f++){var o=T*(f+1),q=o+"_0",G=parseInt(d3.select("rect[id='"+q+"']").attr("x")),J=parseInt(d3.select("rect[id='"+q+"']").attr("y")),K=o+"_"+(a-1),L=parseInt(d3.select("rect[id='"+K+"']").attr("x"))+g,N=parseInt(d3.select("rect[id='"+K+"']").attr("y"))
A.append("line").style("stroke","black").attr("stroke-width",3).attr("x1",G).attr("y1",J).attr("x2",L).attr("y2",N)}for(var f=0;Y>f;f++){var _=T*(f+1),q="0_"+_,G=parseInt(d3.select("rect[id='"+q+"']").attr("x")),J=parseInt(d3.select("rect[id='"+q+"']").attr("y")),K=a-1+"_"+_,L=parseInt(d3.select("rect[id='"+K+"']").attr("x")),N=parseInt(d3.select("rect[id='"+K+"']").attr("y"))+g
A.append("line").style("stroke","black").attr("stroke-width",3).attr("x1",G).attr("y1",J).attr("x2",L).attr("y2",N)}d3.selectAll(".yes_btn").on("click",function(){d3.select("rect[id='yes_btn_boader']").attr("stroke-width",8).attr("stroke","#5CD932"),d3.select("rect[id='no_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),k="yes"}),d3.selectAll(".no_btn").on("click",function(){d3.select("rect[id='yes_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),d3.select("rect[id='no_btn_boader']").attr("stroke-width",8).attr("stroke","#5CD932"),k="no"}),d3.select(".yes_btn").on("click")(),d3.selectAll("rect[class='cell']").on("click",function(){if("yes"==k){var t=d3.select(this).attr("id"),r=t.split("_"),e=parseInt(r[0]),l=parseInt(r[1]),o=d3.select(this).attr("fill")
"black"==o?(d3.select(this).attr("fill","white"),n[e][l]=0):"white"==o&&0==d3.select("#cross_"+t).size()&&(d3.select(this).attr("fill","black"),n[e][l]=1)
for(var d=[],c=0;a>c;c++){var h=e+"_"+c,f=d3.select("rect[id='"+h+"']").attr("fill")
"white"==f?d.push(0):"black"==f&&d.push(1)}d.push(0)
var v=i(d)
if(v.toString()==p[e].toString()){var _="left_a_"+e
d3.select("#"+_).transition().attr("fill",s)}else{var _="left_a_"+e
d3.select("#"+_).transition().attr("fill","white")}for(var u=[],c=0;a>c;c++){var h=c+"_"+l,f=d3.select("rect[id='"+h+"']").attr("fill")
"white"==f?u.push(0):"black"==f&&u.push(1)}u.push(0)
var v=i(u)
if(v.reverse(),v.toString()==y[l].toString()){var _="top_a_"+l
d3.select("#"+_).transition().attr("fill",s)}else{var _="top_a_"+l
d3.select("#"+_).transition().attr("fill","white")}for(var w=[],c=0;c<n.length;c++){var b=i(n[c].concat([0]))
w.push(b)}for(var x=[],c=0;a>c;c++){for(var I=[],m=0;a>m;m++)I.push(n[m][c])
var b=i(I.concat([0]))
x.push(b)}for(var c=0;a>c;c++)if(x[c].reverse(),x[c].join(",")!=y[c].join(","))return
for(var c=0;a>c;c++)if(w[c].join(",")!=p[c].join(","))return
setTimeout(function(){alert("Congrats! You win!")},1100)}else if("no"==k){if("black"==d3.select(this).attr("fill"))return
var C=d3.select(this).attr("id"),j="cross_"+C,z=d3.select("path[id='"+j+"']")
if(1==z.size())z.remove()
else if(0==z.size()){var S=parseInt(d3.select(this).attr("x"))+g/2,$=parseInt(d3.select(this).attr("y"))+g/2
A.append("path").attr("d",d3.svg.symbol().size(350).type(function(t){return"cross"})).attr("id",j).attr("class","cross").attr("transform","translate("+S+","+$+") rotate(45)").attr("fill","red").on("click",function(){d3.select(this).remove()})}}})
for(var f=0;a>f;f++){var q="left_a_"+f,O=parseInt(d3.select("#"+q).attr("x")),Q=parseInt(d3.select("#"+q).attr("y")),U=p[f].join(" "),V=q+"_text"
A.append("text").attr("x",O).attr("y",Q).text(U).attr("id",V)
var W=d3.select("#"+V).node().getBoundingClientRect().width,X=d3.select("#"+V).node().getBoundingClientRect().height
d3.select("#"+V).attr("x",O+j-W-8).attr("y",Q+X/2+C/2-3)}for(var f=0;a>f;f++){var q="top_a_"+f,O=parseInt(d3.select("#"+q).attr("x")),Q=parseInt(d3.select("#"+q).attr("y"))
y[f].reverse()
for(var u=0;u<y[f].length;u++){var V=q+"_text_"+u
A.append("text").attr("x",O).attr("y",Q).text(y[f][u]).attr("id",V)
var W=d3.select("#"+V).node().getBoundingClientRect().width,X=d3.select("#"+V).node().getBoundingClientRect().height
d3.select("#"+V).attr("x",O+m/2-W/2).attr("y",I-u*X-6)}}$("#hint_btn button").click(function(){$("#instructions").is(":visible")?$(this).html("Show How to Play"):$(this).html("Hide How to Play")})})
