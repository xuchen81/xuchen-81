$(function(){function t(t,r){return Math.floor(Math.random()*(r-t+1))+t}var r=[[15,5],[15,4],[15,3],[15,2],[12,5],[12,4],[12,3],[12,2],[10,4],[10,3],[10,2],[10,1],[8,3],[8,2],[8,1]],e=t(0,r.length-1),a=r[e][0],s="#DAF5E8",i=function(t){for(var r=[],e=0,a=0;a<t.length;a++)1==t[a]?e+=1:0==t[a]&&0!=e&&(r.push(e),e=0)
return 0==r.length&&r.push(0),r},l=[],n=[]
for(p=0;a>p;p++){var o=[],d=[]
for(_=0;a>_;_++){var c=t(0,r[e][1])
c>=1?o.push(1):o.push(0),d.push(0)}l.push(o),n.push(d)}for(var h=0,f=[],p=0;p<l.length;p++){var v=i(l[p].concat([0]))
f.push(v),v.length>h&&(h=v.length)}for(var g=[],p=0;a>p;p++){for(var u=[],_=0;a>_;_++)u.push(l[_][p])
var v=i(u.concat([0]))
g.push(v),v.length>h&&(h=v.length)}for(var y=40,k=null,w=50,b=70,x=20,m=20*h,I=30,j=I,C=m,z=a*y+C+50,A=1e3,B=d3.select("#canvas").append("svg").attr("width",z).attr("height",A),p=0;a>p;p++)for(var _=0;a>_;_++){var R=_*y+C+x,S=p*y+m+x
B.append("rect").attr("x",R).attr("y",S).attr("width",y).attr("height",y).attr("fill","white").attr("stroke-width",5).attr("stroke","gray").attr("id",p+"_"+_).attr("class","cell")}for(var p=0;a>p;p++){var R=p*y+C+y/2-I/2+x,S=0
B.append("rect").attr("x",R).attr("y",S).attr("width",I).attr("height",m).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id","top_a_"+p)}for(var p=0;a>p;p++){var R=0,S=p*y+m+y/2-j/2+x
B.append("rect").attr("x",R).attr("y",S).attr("width",C).attr("height",j).attr("fill","white").attr("stroke-width",2).attr("stroke","gray").attr("id","left_a_"+p)}var M=m+2*x+a*y,D=C+x+a*y/2-b-w/2
B.append("rect").attr("x",D).attr("y",M).attr("width",b).attr("height",b).attr("fill","white").attr("stroke-width",4).attr("class","yes_btn").attr("id","yes_btn_boader").attr("stroke","gray"),B.append("rect").attr("x",D+15).attr("y",M+15).attr("width",b-30).attr("height",b-30).attr("fill","black").attr("stroke-width",8).attr("class","yes_btn").attr("stroke","gray")
var E=m+2*x+a*y,F=C+x+a*y/2+w/2
B.append("rect").attr("x",F).attr("y",E).attr("width",b).attr("height",b).attr("fill","white").attr("stroke-width",4).attr("class","no_btn").attr("id","no_btn_boader").attr("stroke","gray")
var T=F+b/2,Y=E+b/2
B.append("path").attr("d",d3.svg.symbol().size(900).type(function(t){return"cross"})).attr("class","no_btn").attr("transform","translate("+T+","+Y+") rotate(45)").attr("fill","red"),d3.selectAll(".yes_btn").on("click",function(){d3.select("rect[id='yes_btn_boader']").attr("stroke-width",10).attr("stroke","green"),d3.select("rect[id='no_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),k="yes"}),d3.selectAll(".no_btn").on("click",function(){d3.select("rect[id='yes_btn_boader']").attr("stroke-width",4).attr("stroke","gray"),d3.select("rect[id='no_btn_boader']").attr("stroke-width",10).attr("stroke","green"),k="no"}),d3.select(".yes_btn").on("click")(),d3.selectAll("rect[class='cell']").on("click",function(){if("yes"==k){var t=d3.select(this).attr("id"),r=t.split("_"),e=parseInt(r[0]),l=parseInt(r[1]),o=d3.select(this).attr("fill")
"black"==o?(d3.select(this).attr("fill","white"),n[e][l]=0):"white"==o&&(d3.select(this).attr("fill","black"),n[e][l]=1)
for(var d=[],c=0;a>c;c++){var h=e+"_"+c,p=d3.select("rect[id='"+h+"']").attr("fill")
"white"==p?d.push(0):"black"==p&&d.push(1)}d.push(0)
var v=i(d)
if(v.toString()==f[e].toString()){var u="left_a_"+e
d3.select("#"+u).transition().attr("fill",s)}else{var u="left_a_"+e
d3.select("#"+u).transition().attr("fill","white")}for(var _=[],c=0;a>c;c++){var h=c+"_"+l,p=d3.select("rect[id='"+h+"']").attr("fill")
"white"==p?_.push(0):"black"==p&&_.push(1)}_.push(0)
var v=i(_)
if(v.reverse(),v.toString()==g[l].toString()){var u="top_a_"+l
d3.select("#"+u).transition().attr("fill",s)}else{var u="top_a_"+l
d3.select("#"+u).transition().attr("fill","white")}for(var w=[],c=0;c<n.length;c++){var b=i(n[c].concat([0]))
w.push(b)}for(var x=[],c=0;a>c;c++){for(var m=[],I=0;a>I;I++)m.push(n[I][c])
var b=i(m.concat([0]))
x.push(b)}for(var c=0;a>c;c++)if(x[c].reverse(),x[c].join(",")!=g[c].join(","))return
for(var c=0;a>c;c++)if(w[c].join(",")!=f[c].join(","))return
setTimeout(function(){alert("Congrats! You win!")},1100)}else if("no"==k){if("black"==d3.select(this).attr("fill"))return
var j=d3.select(this).attr("id"),C="cross_"+j,z=d3.select("path[id='"+C+"']")
if(1==z.size())z.remove()
else if(0==z.size()){var A=parseInt(d3.select(this).attr("x"))+y/2,R=parseInt(d3.select(this).attr("y"))+y/2
B.append("path").attr("d",d3.svg.symbol().size(600).type(function(t){return"cross"})).attr("id",C).attr("class","cross").attr("transform","translate("+A+","+R+") rotate(45)").attr("fill","red").on("click",function(){d3.select(this).remove()})}}})
for(var p=0;a>p;p++){var $="left_a_"+p,q=parseInt(d3.select("#"+$).attr("x")),G=parseInt(d3.select("#"+$).attr("y")),H=f[p].join(" "),J=$+"_text"
B.append("text").attr("x",q).attr("y",G).text(H).attr("id",J)
var K=d3.select("#"+J).node().getBoundingClientRect().width,L=d3.select("#"+J).node().getBoundingClientRect().height
d3.select("#"+J).attr("x",q+C-K-8).attr("y",G+L/2+j/2-4)}for(var p=0;a>p;p++){var $="top_a_"+p,q=parseInt(d3.select("#"+$).attr("x")),G=parseInt(d3.select("#"+$).attr("y"))
g[p].reverse()
for(var _=0;_<g[p].length;_++){var J=$+"_text_"+_
B.append("text").attr("x",q).attr("y",G).text(g[p][_]).attr("id",J)
var K=d3.select("#"+J).node().getBoundingClientRect().width,L=d3.select("#"+J).node().getBoundingClientRect().height
d3.select("#"+J).attr("x",q+I/2-K/2).attr("y",m-_*L-6)}}})
